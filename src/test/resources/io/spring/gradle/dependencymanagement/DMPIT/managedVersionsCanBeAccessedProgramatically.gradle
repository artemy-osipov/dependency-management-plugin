plugins {
	id "io.spring.dependency-management"
	id "java"
}

repositories {
	mavenCentral()
}

dependencyManagement {
	imports {
		mavenBom 'io.spring.platform:platform-bom:1.0.1.RELEASE'
	}
	testRuntimeOnly {
		dependencies {
			dependency 'com.foo:bar:1.2.3'
		}
	}
	dependencies {
		dependencySet(group: 'com.alpha', version: '1.0') {
			entry 'bravo'
			entry 'charlie'
		}
	}
}

task verify {
	def implementationManagedVersions = dependencyManagement.implementation.managedVersions
	def implementationManagedVersionsOutput = new File("${buildDir}/implementation-managed-versions.txt")
	def testRuntimeOnlyManagedVersions = dependencyManagement.testRuntimeOnly.managedVersions
	def testRuntimeOnlyManagedVersionsOutput = new File("${buildDir}/testRuntimeOnly-managed-versions.txt")
	def managedVersions = dependencyManagement.managedVersions
	def managedVersionsOutput = new File("${buildDir}/managed-versions.txt")
	doFirst {
		implementationManagedVersionsOutput.parentFile.mkdirs()
		implementationManagedVersions.each { key, value ->
			implementationManagedVersionsOutput << "${key} -> ${value}\n"
		}
		testRuntimeOnlyManagedVersionsOutput.parentFile.mkdirs()
		testRuntimeOnlyManagedVersions.each { key, value ->
			testRuntimeOnlyManagedVersionsOutput << "${key} -> ${value}\n"
		}
		managedVersionsOutput.parentFile.mkdirs()
		managedVersions.each { key, value ->
			managedVersionsOutput << "${key} -> ${value}\n"
		}
	}
}
